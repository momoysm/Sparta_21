<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자바를 자바조</title>
    <style>
        /* 그리드 컨테이너 스타일 */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3개의 열로 설정 */
            gap: 10px;
            /* 그리드 아이템 간격 설정 */
            justify-content: center;
            /* 수평 가운데 정렬 */
            overflow: auto;
            /* 스크롤바 추가 */
            max-height: 70vh;
            /* 최대 높이 설정 */
        }

        /* 각 그리드 아이템 스타일 */
        .grid-item {
            border: 1px solid #ccc;
            padding: 10px;
            display: flex;
            /* 아이템 내부 요소들을 수평 정렬하기 위해 추가 */
            align-items: center;
            /* 아이템 내부 요소들을 수직 가운데 정렬하기 위해 추가 */
        }

        .grid-item img {
            width: 50%;
            /* 사진을 왼쪽 절반으로 설정 */
            height: 80%;
            border-radius: 5px;
            margin-right: 10px;
            /* 사진과 정보 사이 간격 조정 */
        }

        .grid-item-content {
            flex-grow: 1;
            /* 내용이 넘치더라도 여백이 없도록 설정 */
        }

        /* 평점 스타일 */
        .rating {
            font-size: 16px;
            /* 평점 별 크기 조정 */
            color: #f39c12;
            /* 별 색상 */
            display: flex;
            align-items: center;
        }

        /* .star {
            color: #f39c12;
            /* 별 색상 */
            /* margin-right: 1px; */
            /* 별 간격 */

        .rating-value {
            margin-left: 5px;
            /* 숫자와의 간격 조정 */
        }

        /* 검색창 스타일 */
        .search-container {
            display: flex;
            justify-content: center;
            /* 가운데 정렬 */
            align-items: center;
            /* 수직 가운데 정렬 */
            margin-bottom: 10px;
            /* 검색창과 그리드 간격 조정 */
            grid-column: 1 / -1;
            /* 전체 그리드 컬럼에 걸치도록 설정 */
        }

        .search-filter {
            margin-right: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        .search-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 250px;
            /* 검색창의 너비 조정 */
            margin-right: 10px;
            /* 검색창과 버튼 간격 조정 */
        }

        /* 로그인 버튼 스타일 */
        .login-button,
        .signup-button,
        .search-button {
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            /* 왼쪽 여백 추가 */
        }

        /* 리뷰 추가 버튼 스타일 */
        .add-review-button {
            padding: 5px 20px;
            /* 회원가입 버튼과 동일한 크기로 설정 */
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            /* 왼쪽 여백 추가 */
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase 구성 정보 설정
        const firebaseConfig = {
            // 본인 설정 내용 채우기 
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            apiKey: "AIzaSyAMI7WlpKtivs-ZOEHimDcsiy2SXeTC_9g",
            authDomain: "sparta-miniproject-ea935.firebaseapp.com",
            projectId: "sparta-miniproject-ea935",
            storageBucket: "sparta-miniproject-ea935.appspot.com",
            messagingSenderId: "179160568879",
            appId: "1:179160568879:web:929d38c3e0b3dc7499e2da"

        };


        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 검색 버튼 클릭 이벤트 핸들러 추가
        $('.search-button').on('click', async function () {
            // 검색 필터 및 검색어 가져오기
            let searchFilter = $('.search-filter').val();
            let searchText = $('.search-input').val().trim().toLowerCase();

            // Firebase에서 리뷰 데이터 가져오기
            let docs = await getDocs(collection(db, "User_review"));

            // 검색 결과를 담을 배열
            let searchResults = [];

            // 각 리뷰 데이터에 대해 처리
            docs.forEach((doc) => {
                let row = doc.data();

                let id = row['userid'].toLowerCase();
                let hotel = row['userhotelname'].toLowerCase();
                let userRegion = row['userRigion'].toLowerCase();
                let review = row['userreview'].toLowerCase();

                // 검색 필터에 따라 검색어가 해당 필드에 포함되는지 확인
                if ((searchFilter === 'id' && id.includes(searchText)) ||
                    (searchFilter === 'accommodation' && hotel.includes(searchText)) ||
                    (searchFilter === 'location' && userRegion.includes(searchText)) ||
                    (searchFilter === 'rating' && row['usergrade'] == searchText) || // 평점은 정확한 값으로 비교
                    (searchFilter === 'review' && review.includes(searchText))) { // 리뷰내용 추가
                    searchResults.push(row);
                }
            });

            // 검색 결과를 출력
            renderSearchResults(searchResults);
        });


        // 검색 결과를 출력하는 함수
        function renderSearchResults(results) {
            // 그리드 컨테이너 초기화
            $('.grid-container').empty();

            // 검색 결과를 그리드에 추가
            results.forEach(row => {
                let image = row['userimg'];
                let id = row['userid'];
                let hotel = row['userhotelname'];
                let userRegion = row['userRigion'];
                let grade = row['usergrade'];
                let review = row['userreview'];
                
                let ratingText = `(${grade})`;
                let temp_html = `
            <div class="grid-item">
                <img src="${image}" alt="숙소 이미지">
                <div class="grid-item-content">
                    <p><strong>아이디:</strong> ${id}</p>
                    <p><strong>숙소명:</strong> ${hotel}</p>
                    <p><strong>지역:</strong> ${userRegion}</p>
                    <p><strong>평점:</strong>
                        <span class="rating">
                            ${"★".repeat(Math.floor(grade))}${"☆".repeat(5 - Math.floor(grade))}
                            <span class="rating-value">${ratingText}</span>
                        </span>
                    </p>
                    <p><strong>리뷰내용:</strong> ${review}</p>
                </div>
            </div>`;
                $('.grid-container').append(temp_html);
            });
        }


        (async () => {
            let docs = await getDocs(collection(db, "User_review"));
            docs.forEach((doc) => {
                let row = doc.data();
                console.log(row);

                let image = row['userimg'];
                let id = row['userid'];
                let hotel = row['userhotelname'];
                let userRegion = row['userRigion'];
                let grade = row['usergrade'];
                let review = row['userreview'];

                let temp_html = `
                <div class="grid-item">
                    <img src="${image}" alt="숙소 이미지">
                    <div class="grid-item-content">
                        <p><strong>아이디:</strong> ${id}</p>
                        <p><strong>숙소명:</strong> ${hotel}</p>
                        <p><strong>지역:</strong> ${userRegion}</p>
                        <p><strong>평점:</strong>
                            <span class="rating">
                                ${"★".repeat(Math.floor(grade))}${"☆".repeat(5 - Math.floor(grade))}
                                <span class="rating-value">${grade}</span>
                            </span>
                        </p>
                        <p><strong>리뷰내용:</strong> ${review}</p>
                    </div>
                </div>`;
                $('.grid-container').append(temp_html);
            });
        })();
    </script>


</head>

<body>
    <header>
        <!-- 검색창 -->
        <div class="search-container">
            <!-- 검색 필터 -->
            <select class="search-filter">
                <option value="id">아이디</option>
                <option value="accommodation">숙소명</option>
                <option value="location">지역</option>
                <option value="rating">평점</option>
                <option value="review">리뷰내용</option>
            </select>
            <!-- 검색창 -->
            <input type="text" class="search-input" placeholder="검색어를 입력하세요">
            <!-- 검색 버튼 -->
            <button class="search-button">검색</button>
            <!-- 로그인 버튼 -->
            <button class="login-button">로그인</button>
            <!-- 회원가입 버튼 -->
            <button class="signup-button">회원가입</button>
            <!-- 리뷰를 추가해주세요 버튼 -->
            <button class="add-review-button">리뷰를 추가해보세요</button>
        </div>
    </header>
    <!-- 그리드 레이아웃으로 숙소 정보 표시 -->
    <div class="grid-container"></div>
</body>

</html>