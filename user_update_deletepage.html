<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>죠기어때</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

    <link rel="stylesheet" href="header.css">

    <style>
        /* 그리드 컨테이너 스타일 */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3개의 열로 설정 */
            gap: 10px;
            /* 그리드 아이템 간격 설정 */
            justify-content: center;
            /* 수평 가운데 정렬 */
            overflow: auto;
            /* 스크롤바 추가 */
            max-height: 70vh;
            /* 최대 높이 설정 */
        }

        /* 각 그리드 아이템 스타일 */
        .grid-item {
            border: 1px solid #ccc;
            padding: 10px;
            display: flex;
            /* 아이템 내부 요소들을 수평 정렬하기 위해 추가 */
            align-items: center;
            /* 아이템 내부 요소들을 수직 가운데 정렬하기 위해 추가 */
        }

        .grid-item img {
            width: 50%;
            /* 사진을 왼쪽 절반으로 설정 */
            height: 80%;
            border-radius: 5px;
            margin-right: 10px;
            /* 사진과 정보 사이 간격 조정 */
        }

        .grid-item-content {
            flex-grow: 1;
            /* 내용이 넘치더라도 여백이 없도록 설정 */
        }

        /* 평점 스타일 */
        .rating {
            font-size: 16px;
            /* 평점 별 크기 조정 */
            color: #f39c12;
            /* 별 색상 */
            display: flex;
            align-items: center;
        }

        .rating-value {
            margin-left: 5px;
            /* 숫자와의 간격 조정 */
        }

        .search-filter {
            margin-right: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        /* 리뷰 추가 버튼 스타일 */
        .contentBtn {
            margin-left: 10px;
        }

        /* 삭제 버튼 스타일 */
        .delete-button {
            padding: 5px 10px;
            background-color: #dc3545;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            /* 위쪽 여백 추가 */
        }

        /* 수정 및  */
        .modify-button {
            padding: 5px 10px;
            background-color: #3d35dc;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }


    </style>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase 구성 정보 설정
        const firebaseConfig = {
            // 본인 설정 내용 채우기 
            apiKey: "AIzaSyAMI7WlpKtivs-ZOEHimDcsiy2SXeTC_9g",
            authDomain: "sparta-miniproject-ea935.firebaseapp.com",
            projectId: "sparta-miniproject-ea935",
            storageBucket: "sparta-miniproject-ea935.appspot.com",
            messagingSenderId: "179160568879",
            appId: "1:179160568879:web:929d38c3e0b3dc7499e2da"

        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 검색 버튼 클릭 이벤트 핸들러 추가
        $('.searchBtn').on('click', async function () {
            // 검색 필터 및 검색어 가져오기
            let searchFilter = $('.search-filter').val();
            let searchText = $('.search-input').val().trim().toLowerCase();

            // Firebase에서 리뷰 데이터 가져오기
            let docs = await getDocs(collection(db, "User_review"));

            // 검색 결과를 담을 배열
            let searchResults = [];

            // 각 리뷰 데이터에 대해 처리
            docs.forEach((doc) => {
                let row = doc.data();

                let id = row['userid'].toLowerCase();
                let hotel = row['userhotelname'].toLowerCase();
                let userRegion = row['userRigion'].toLowerCase();
                let review = row['userreview'].toLowerCase();

                // 검색 필터에 따라 검색어가 해당 필드에 포함되는지 확인
                if ((searchFilter === 'id' && id.includes(searchText)) ||
                    (searchFilter === 'accommodation' && hotel.includes(searchText)) ||
                    (searchFilter === 'location' && userRegion.includes(searchText)) ||
                    (searchFilter === 'rating' && row['userrate'] == searchText) || // 평점은 정확한 값으로 비교
                    (searchFilter === 'review' && review.includes(searchText))) { // 리뷰내용 추가
                    searchResults.push(row);
                }
            });

            // 검색 결과를 출력
            renderSearchResults(searchResults);
        });


        // 검색 결과를 출력하는 함수
        function renderSearchResults(results) {
            // 그리드 컨테이너 초기화
            $('.grid-container').empty();

            // 검색 결과를 그리드에 추가
            results.forEach(row => {
                let image = row['userimg'];
                let id = row['userid'];
                let hotel = row['userhotelname'];
                let userRegion = row['userRigion'];
                let grade = row['userrate'];
                let review = row['userreview'];

                let ratingText = `(${grade})`;
                let temp_html = `
            <div class="grid-item">
                <img src="${image}" alt="숙소 이미지">
                <div class="grid-item-content">
                    <p><strong>아이디:</strong> ${id}</p>
                    <p><strong>숙소명:</strong> ${hotel}</p>
                    <p><strong>지역:</strong> ${userRegion}</p>
                    <p><strong>평점:</strong>
                        <span class="rating">
                            ${"★".repeat(Math.floor(grade))}${"☆".repeat(5 - Math.floor(grade))}
                            <span class="rating-value">${ratingText}</span>
                        </span>
                    </p>
                    <p><strong>리뷰내용:</strong> ${review}</p>
                    <button class="modify-button">수정하기</button>
                    <button class="delete-button">삭제하기</button>
                </div>
            </div>`;
                $('.grid-container').append(temp_html);
            });
        }


        (async () => {
            let docs = await getDocs(collection(db, "User_review"));
            docs.forEach((doc) => {
                let row = doc.data();
                console.log(row);

                let image = row['userimg'];
                let id = row['userid'];
                let hotel = row['userhotelname'];
                let userRegion = row['userRigion'];
                let grade = row['userrate'];
                let review = row['userreview'];
                let ratingText = `(${grade})`;

                let temp_html = `
                <div class="grid-item">
                    <img src="${image}" alt="숙소 이미지">
                    <div class="grid-item-content">
                        <p><strong>아이디:</strong> ${id}</p>
                        <p><strong>숙소명:</strong> ${hotel}</p>
                        <p><strong>지역:</strong> ${userRegion}</p>
                        <p><strong>평점:</strong>
                            <span class="rating">
                                ${"★".repeat(Math.floor(grade))}${"☆".repeat(5 - Math.floor(grade))}
                                <span class="rating-value">${ratingText}</span>
                            </span>
                        </p>
                        <p><strong>리뷰내용:</strong> ${review}</p>
                        <button class="modify-button">수정하기</button>
                        <button class="delete-button">삭제하기</button>
                    </div>
                </div>`;
                $('.grid-container').append(temp_html);
            });
        })();
    </script>


</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">죠기어때</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <form class="d-flex" role="search">
                <select class="search-filter">
                    <option value="id">아이디</option>
                    <option value="accommodation">숙소명</option>
                    <option value="location">지역</option>
                    <option value="rating">평점</option>
                    <option value="review">리뷰내용</option>
                </select>
                <input class="form-control me-2 search-input" type="search" id="search" placeholder="검색어를 입력해주세요!"
                    aria-label="Search">
                <button class="btn btn-outline-success searchBtn" type="button" id="search">검색하기</button>
                <button class="btn btn-outline-success contentBtn" type="button" id="content">리뷰를 추가해주세요.</button>
            </form>
            <div class="sign">

                <button type="button" id="mypage" class="btn btn-light">마이페이지</button>
                <button type="button" id="sign-out" class="btn">로그아웃</button>
            </div>
        </div>
    </nav>
    <div class="grid-container"></div>

</body>

</html>